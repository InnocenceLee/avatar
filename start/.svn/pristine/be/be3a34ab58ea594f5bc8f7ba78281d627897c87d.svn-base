<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.2//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rkjh.eschool.dao.ExamPaperDao">
	
	<select id="list" resultType="java.util.Map"  parameterType="java.util.Map">
	    <![CDATA[select a.id,a.name,a.difficulty,a.question_count,array_to_string(a.knowledges,',') knowledges,a.variance,a.mode,a.content,a.duration,a.state,a.totle_score,belong,to_char(a.create_date, 'YYYY-MM-DD') create_date,a.person personId,a.p_type,a.quesions_num,a.node,
	    b.name personName,e.id nodeId,e.name nodeName,a.discribe
	    from exam_paper a,person b,person_station c,sys_station d,node e where a.person = b.id and b.id = c.person and c.station=d.id and d.node=e.id
	    ]]>
	    <if test="id != 0">  
	        and a.id = #{id}
	    </if> 
	    <if test="name != null and name != ''">  
	        and a.name like '%'||#{name}||'%'
	    </if> 
	    <if test="state != null and state != ''">  
	        and a.state = #{state}  
	    </if>  
	    <if test="mode != null and mode != ''">  
	        and a.mode = #{mode}  
	    </if>  
		limit  #{size} offset #{start}
	</select>


	<select id="listCount" resultType="java.lang.Integer"  parameterType="java.util.Map">
	   <![CDATA[select count(1)
	    from exam_paper a,person b,person_station c,sys_station d,node e where a.person = b.id and b.id = c.person and c.station=d.id and d.node=e.id
	    ]]>
	    <if test="id != 0">  
	        and a.id = #{id}
	    </if> 
	    <if test="state != null and state != ''">  
	        and a.state = #{state}  
	    </if>  
	    <if test="mode != null and mode != ''">  
	        and a.mode = #{mode}  
	    </if>  
	</select>
	
	<select id="auditList" resultType="java.util.Map"  parameterType="java.util.Map">
	    <![CDATA[
	        select id,name,difficulty,question_count,array_to_string(knowledges,',') knowledges,variance,mode,content,duration,state,totle_score,belong,to_char(a.create_date, 'YYYY-MM-DD') create_date,person,p_type,quesions_num,node from exam_paper 
	        where 1=1 
	    ]]>
	    <if test="id != null">  
	        and id = #{id}
	    </if>
	    <if test="state != null">  
	        and state = #{state}  
	    </if> 
	    <if test="mode != null">  
	        and mode = #{mode}  
	    </if>  
	    <if test="size != null and start!=null">  
	        limit  #{size} offset #{start}
	    </if> 
		
	</select>
	
	<insert id="add" useGeneratedKeys="true" keyProperty="id" parameterType="java.util.Map">
		insert into exam_paper(id,name,difficulty,question_count,knowledges,variance,mode,content,duration,state,totle_score,belong,create_date,person,p_type,quesions_num,node,discribe)
 			values(DEFAULT,#{name},#{difficulty},#{question_count},ARRAY[
 			<foreach collection="knowledges" index="index" item="item" separator=",">   
       	 		#{item}   
    		</foreach>
 			],#{variance},#{mode},#{content,jdbcType=OTHER,typeHandler=JSONOBJECT},#{duration},#{state},#{totle_score},#{belong},#{create_date},#{person},#{p_type},#{quesions_num,jdbcType=OTHER,typeHandler=JSONOBJECT},#{node},#{discribe})
	</insert>
	
	<update id="updateOne" parameterType="java.util.Map">
		update 
			exam_paper 
				set 
					<if test="content != null">  
				        content=#{content,jdbcType=OTHER,typeHandler=JSONOBJECT}
				    </if>
						where 
							id = #{id}
	</update>
	
	<update id="update" parameterType="java.util.Map">
		update 
			exam_paper 
				set 
				    id = #{id}
				    <if test="name != null">  
					,name=#{name}
					</if>
					<if test="difficulty != null">
					,difficulty=#{difficulty}
					</if>
					<if test="question_count != null">
					,question_count=#{question_count}
					</if>
					<if test="knowledges != null">
						,knowledges=ARRAY[
			 			<foreach collection="knowledges" index="index" item="item" separator=",">   
			       	 		#{item}   
			    		</foreach>]
					</if>
					<if test="variance != null">
					,variance=#{variance}
				    </if>
					<if test="mode != null">
					,mode=#{mode}
					</if>
					<if test="content != null">
					,content=#{content}
					</if>
					<if test="duration != null">
					,duration=#{duration}
					</if>
					<if test="state != null">
					,state=#{state}
					</if>
					<if test="totle_score != null">
					,totle_score=#{totle_score}
					</if>
					<if test="belong != null">
					,belong=#{belong}
					</if>
					<if test="create_date != null">
					,create_date=#{create_date}
					</if>
					<if test="person != null">
					,person=#{person}
					</if>
					<if test="p_type != null">
					,p_type=#{p_type}
					</if>
					<if test="quesions_num != null">
					,quesions_num=#{quesions_num,jdbcType=OTHER,typeHandler=JSONOBJECT}
					</if>
					<if test="node != null">
					,node=#{node}
					</if>
					<if test="discribe != null">
					,discribe=#{discribe}
					</if>
				where 
					id = #{id}
	</update>
	
	
	<delete id="dels" parameterType="java.lang.Integer">
		delete from exam_paper where id in 
		<foreach collection="array" index="index" item="item" open="(" separator="," close=")">   
       	 	#{item}   
    	</foreach>
	</delete>
</mapper>