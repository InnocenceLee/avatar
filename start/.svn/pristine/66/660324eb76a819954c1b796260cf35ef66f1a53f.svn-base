<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.2//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rkjh.eschool.dao.GroupDao">

	<insert id="add" useGeneratedKeys="true" keyProperty="id" parameterType="java.util.Map">
		insert into "group"(id,name,persons,belong)
 			values(DEFAULT,#{name},ARRAY[
 			<foreach collection="persons" index="index" item="item" separator=",">   
       	 		#{item}   
    		</foreach>
 			],#{belong})
	</insert>
	
	<delete id="dels" parameterType="java.util.Map">
		delete from "group" where id in 
		<foreach collection="ids" index="index" item="item" open="(" separator="," close=")">   
       	 	#{item}   
    	</foreach>
	</delete>
	
	<select id="list" resultType="java.util.Map" parameterType="java.util.Map">
	    select id,name,array_to_string(persons,',') persons,belong from "group" 
	    where 1=1  
	    <if test="belong != null and belong !=0">  
	        and belong = #{belong}
	    </if>  
	    <if test="names != null">
			and name in 
		    <foreach collection="names" index="index" item="item" open="(" separator="," close=")">   
	       	 	#{item}   
	    	</foreach> 
	    </if>  
	</select>
	
	<select id="listPersonByIds" resultType="java.util.Map" parameterType="java.util.Map">
	    select d.id,d.name,c.name nodeName from person d,person_station a,sys_station b,node c where d.id=a.person and a.station=b.id and b.node=c.id and d.id in
		<foreach collection="ids" index="index" item="tag" open="("
    		separator="," close=")">
    		#{tag}
    	</foreach>
    	limit  #{size} offset #{start}
	</select>
	
	<select id="listPersonCountByIds" resultType="java.lang.Integer" parameterType="java.util.Map">
	    select count(1) from person d,person_station a,sys_station b,node c where d.id=a.person and a.station=b.id and b.node=c.id and d.id in
		<foreach collection="ids" index="index" item="tag" open="("
    		separator="," close=")">
    		#{tag}
    	</foreach>
	</select>
</mapper>